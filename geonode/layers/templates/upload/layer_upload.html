{% extends "upload/layer_upload_base.html" %} 
{% load i18n %} 
{% load staticfiles %} 

{% block title %} {% trans "Upload Layer" %} - {{ block.super }} {% endblock %} 
{% block body_class %}layers upload{% endblock %} 
{% block head %} {{ block.super }} {% endblock %} 

{% block middle %} 
    <nav class="red darken-3 breadcrumb-universal">
        <div class="nav-wrapper">
            <div class="col s12">
                <a href="{% url 'layer_browse' %}?limit={{ CLIENT_RESULTS_LIMIT }}" class="breadcrumb">{% trans "Layers" %}</a>
                <a href="{% url 'layer_upload' %}" class="breadcrumb">{% trans "Upload Layers" %}</a>
            </div>
        </div>
    </nav>
    {{ block.super }}
{% endblock middle %}

{% block body_outer %}
    <section style="min-height: 64vh;">
        <div class="" style="padding: 0 15px;">
            <a href="{% url "layer_browse" %}?limit={{ CLIENT_RESULTS_LIMIT }}" class="btn waves-effect waves-light red darken-3 right">{% trans "Explore Layers" %}</a>
            <h4 class="">{% trans "Upload Layers" %}</h4>
    
            <script language="javascript">
                var json_mosaics = [
                    {% for mosaic in mosaics %} 
                        {
                        "name": "{{mosaic.name}}",
                        "workspace": "{{mosaic.workspace}}",
                        "is_mosaic": "{{mosaic.is_mosaic}}",
                        "has_time": "{{mosaic.has_time}}",
                        "has_elevation": "{{mosaic.has_elevation}}",
                        "time_regex": "{{mosaic.time_regex}}",
                        "elevation_regex": "{{mosaic.elevation_regex}}"
                        },
                    {% endfor %}
                ]
            </script>
        </div>
        <div class="row">
            <div class="col s12 l12">
                <section id="drop-zone" class="grey lighten-4 grey-text text-darken-1">
                    <div class="center">
                        <i class="material-icons">cloud_upload</i>
                        <br>
                        <span>
                            {% trans "Drop files to upload or" %}
                            <form id="file-uploader" method="post" enctype="multipart/form-data">
                                <!-- UI change to hide the list of previously uploaded files from the user -->
                                <input type="file" id="file-input" style="display: none;" multiple>
                                <input class="btn red darken-3" type="button" value="Choose Files" onclick="document.getElementById('file-input').click();">
                            </form>
                        </span>
                    </div>
                </section>
            </div>
            <div class="col s12 l12">
                {% if incomplete %}
                <section class="widget" id="incomplete-download-list">
                    <h3>{% trans "Incomplete Uploads" %}</h3>
                    <p>{% trans "You have the following incomplete uploads" %}:</p>
                    {% for u in incomplete %}
                    <div class="clearfix uip" id="incomplete-{{ u.import_id }}">
                        <div class="pull-left">{{ u.name }}, {% trans "last updated on" %} {{ u.date }}</div>
                        <div class="upload_actions pull-right">
                            <a class="btn" href="#" id="resume-{{ u.import_id }}">{% trans "Resume" %}</a>
                            <a class="btn" href="#" id="delete-{{ u.import_id }}">
                            <i class="icon-trash"></i> {% trans "Delete" %}</a>
                        </div>
                    </div>
                    {% endfor %}
                </section>
                <div id="confirm-delete" class="hidden alert alert-warning">
                    {% trans "Are you sure you want to delete this upload?" %}
                    <a href="#y" class="btn ">{% trans "Delete" %}</a>
                    <a href="#n" class="btn btn-flat">{% trans "Cancel" %}</a>
                    <a href="#yy">{% trans "Delete, and don't ask me again." %}</a>
                </div>
                {% endif %}
    
                {% block additional_info %}
                {% endblock additional_info %} 
    
                {% if errors %}
                <div id="errors" class="alert alert-danger">
                    {% for error in errors %}
                    <p>{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}
                <div id="upload-status"></div>
                <section class="widget">
                    <ul id="global-errors"></ul>
                    <p>{% trans "Files to be uploaded" %} :</p>
                    <div id="file-queue"></div>
                    <div class="checkbox" style="display:none;" id="metadata_uploaded_preserve_check">
                        Preserve Metadata XML
                        <input type="checkbox" name="metadata_uploaded_preserve" id="id_metadata_uploaded_preserve" />
                    </div>
                </section>
                <section class="charset row">
                    <div class="input-field col s12 l3">
                        <select id="charset">
                            {% for charset in charsets %} 
                                {% if charset.0 == 'UTF-8' %}
                                <option selected='selected' value={{ charset.0 }}>{{ charset.1 }}</option>
                                {% else %}
                                <option value={{ charset.0 }}>{{ charset.1 }}</option>
                                {% endif %} 
                            {% endfor %}
                        </select>
                        <label>{% trans "Select Charset" %}</label>
                    </div>
                </section>
                <section>
                    <a href="#" id="upload-button" class="btn waves-effect waves-light red darken-3">{% trans "Upload files" %}</a>
                    <!-- Modal Trigger -->
                    <a href="#modal_permission" id="" class="btn-flat modal-trigger waves-effect waves-light red-text text-darken-3" style="border: 1px solid;">{% trans "Change Permissions" %}</a>
                    <a href="{% url "layer_upload" %}" id="clear-button" class="btn-flat waves-effect waves-light">{% trans "Clear" %}</a>
                </section>

                <form id="permission_form">
                    {% include "_permissions02.html" %}
                </form>

            </div>
        </div>
    </section>
{% endblock body_outer %} 

{% block extra_script %} 
    {{ block.super }}
    <script data-main="{% static 'geonode/js/upload/main' %}" src="{% static 'lib/js/require.js' %}">
    </script>
    <script type="text/javascript">
        {% autoescape off %}
            csrf_token = "{{ csrf_token }}",
            form_target = "{{ UPLOADER_URL }}",
            geogig_enabled = {{ GEOGIG_ENABLED | lower }},
            time_enabled = {{ TIME_ENABLED | lower }},
            mosaic_enabled = {{ MOSAIC_ENABLED | lower }},
            userLookup = "{% url "account_ajax_lookup" %}"
        {% endautoescape %}
    </script>
    {% if GEONODE_SECURITY_ENABLED %} 
        {% with resource=layer %} 
            {% include "_permissions_form_js.html" %} 
        {% endwith %} 
    {% endif %} 
{% endblock extra_script %}
